---
layout: post
title:  "Django添加国际化支持"
date:   2021-05-28 09:14:25 +0800
categories: Django
---

# Django 添加i18n支持

## settings.py 配置

```python
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR, 'front', 'templates')]
        ,
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                ...
                # 添加多语言支持
                'django.template.context_processors.i18n',
            ],
            'builtins': [
                'django.templatetags.static'
            ]
        },
    },
]

# 默认语言
# LANGUAGE_CODE = 'en-us'
LANGUAGE_CODE = 'zh-hans'

# 支持语言列表
LANGUAGES = (
    ('zh-hans', '中文简体'),
    ('en', 'English'),
    ('fr', 'French')
)

# Locale根目录，在项目根目录下创建locale文件夹。
LOCALE_PATHS = (
    os.path.join(BASE_DIR, 'locale'),
)

# 时区
# TIME_ZONE = 'UTC'
# 获取TIME_ZONE列表可以使用：
# import pytz
# pytz.all_timezones
#TIME_ZONE = 'Asia/Shanghai'
# 刚果时区：GMT+1
TIME_ZONE = 'Africa/Brazzaville'

# 开启国际化
USE_I18N = True

# 开启本地化
USE_L10N = True

```



## views 
```python
from django.utils.translation import ugettext as _
    str = '中文测试'
    context = {
        # 需要翻译的字符串调用_()
        'str': _(str)
    }
    return render(request, 'settings/index.html', context=context)

```


## templates

```

<!-- 这里添加i18n支持 -->
<!-- {% load i18n %} -->

{% block content %}
    <!-- 使用trans标签翻译字符串 -->
    {% trans str %}
{% endblock %}
```


## 生成翻译文件
```bash
# 生成翻译文件
python manage.py makemessages -l en

# 编译翻译文件
python manage.py compilemessages -l en

```

## 生成翻译文件(中文)
```bash
python manage.py makemessages -l zh_hans

python manage.py compilemessages -l zh_hans

```

## 语言转换关系(以中、法、英为例)
1. 翻译成 法语
```python
# 默认语言设置
LANGUAGE_CODE = 'fr'

# 要翻译的模版页面
{% trans "中文翻译测试" %}

# locale文件夹的 zh_hans文件中：
#: front/templates/settings/index.html:8
msgid "中文翻译测试"
msgstr "Test de traduction en chinois"

#: front/templates/settings/index.html:9
msgid "Chinese"
msgstr "chinois"

# make and compile messages
python manage.py makemessages -l fr
python manage.py compilemessages -l fr
```



1. 翻译成 英文
```python
# 默认语言设置
LANGUAGE_CODE = 'en'

# 要翻译的模版页面
{% trans "中文翻译测试" %}

# locale文件夹的 zh_hans文件中：
#: front/templates/settings/index.html:8
msgid "中文翻译测试"
msgstr "Chinese translation test"

#: front/templates/settings/index.html:9
msgid "Chine"
msgstr "China"

# make and compile messages
python manage.py makemessages -l en
python manage.py compilemessages -l en
```

3. 翻译成中文
注意这里巨坑：
```python
# 默认语言设置（注意：这里是中线“-”）
LANGUAGE_CODE = 'zh-Hans'

# 支持语言设置（注意：这里是中线“-”）
LANGUAGES = (
    ('zh-Hans', '中文简体'),
    ('en', 'English'),
    ('fr', 'French')
)

# 要翻译的模版页面
{% trans "中文翻译测试" %}

# locale文件夹的 zh_hans文件中：
#: front/templates/settings/index.html:8
msgid "中文翻译测试"
msgstr "Chinese translation test"

#: front/templates/settings/index.html:9
msgid "Chine"
msgstr "China"

# make and compile messages注意这里是下线“_”
python manage.py makemessages -l zh_Hans
python manage.py compilemessages -l zh_Hans
```

